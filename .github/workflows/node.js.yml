name: Gaoji Integration
on:
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - name: Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.MACHINE116 }}
          known_hosts: "just-a-placeholder-so-we-dont-get-errors"
      - name: Adding Known Hosts Into 116
        run: ssh-keyscan -H ${{ secrets.HOST_72 }} >> ~/.ssh/known_hosts
      - uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}
      - name: Build
        run: |
          echo ${{ github.sha }}
          git_hash=`git rev-parse --short ${{ github.sha }}`
          echo ${git_hash}
          echo ${{github.event.inputs.customer}}
          mkdir pub
          echo 'text' >> pub/a.txt
          currentTime=`date +'%m%d%H%M%S'`
          zip -q -r pub-${currentTime}.zip pub
          rsync -avz --delete ./pub-${currentTime}.zip ${{ secrets.USER_OF_116 }}@${{ secrets.HOST_72 }}:/home/flashcat/local/download
          echo "--------------------------------------- "
          echo "pub-${currentTime}.zip"
          curl 'http://117.51.142.214:3000/a' \
            -H 'Content-Type: application/json' \
            -d '{"msgtype": "text","text": {"content": '${secrets.DOWNLOADLINK}/pub-${currentTime}'.zip}}'
